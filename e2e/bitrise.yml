format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

workflows:
  # test_hang:
  #   envs:
  #   - DESTINATION: platform=iOS Simulator,name=iPhone 8,OS=latest
  #   - TIMEOUT: 1
  #   after_run:
  #   - _run
  #   - _check_outputs

  test_create_device:
    envs:
    - DESTINATION: platform=iOS Simulator,name=iPhone Xs Max,OS=latest
    - TIMEOUT: 0
    after_run:
      - _run
      - _check_outputs

  _run:
    steps:
    - path::./:
        inputs:
        - destination: $DESTINATION
        - reset: "yes"
        - wait_for_boot_timeout: 1

  _check_outputs:
    steps:
    - git::https://github.com/bitrise-steplib/bitrise-step-check-step-outputs.git@main:
        is_always_run: true
        inputs:
        - envs: |-
            BITRISE_SIMULATOR_STATUS
            BITRISE_XCODE_DESTINATION
        - files:
        - dirs:
        - deploy_dir:
        - deployed_files:
        - deployed_dirs:
